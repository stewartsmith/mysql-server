# This test uses chmod, can't be run with root permissions
--source include/not_as_root.inc

###########################################################################

--echo
--echo # --
--echo # -- Bug#26704: Failing DROP DATABASE brings mysql-client out of sync.
--echo # --

--echo
--disable_warnings
DROP DATABASE IF EXISTS mysql_test;
--enable_warnings

--echo
CREATE DATABASE mysql_test;
CREATE TABLE mysql_test.t1(c INT);

use mysql_test;

--echo
--echo chmod 000 mysql_test/t1.frm
--chmod 0000 $MYSQLTEST_VARDIR/master-data/mysql_test/t1.frm

# NOTE: ER_DB_DROP_RMDIR contains errno, which can be different on different
# platforms.

--echo
--disable_result_log
--error ER_DB_DROP_RMDIR
DROP DATABASE mysql_test;
--enable_result_log

--echo
SELECT DATABASE();

--echo
--echo rm mysql_test/t1.MYD mysql_test/t1.MYI
--remove_file $MYSQLTEST_VARDIR/master-data/mysql_test/t1.MYD
--remove_file $MYSQLTEST_VARDIR/master-data/mysql_test/t1.MYI

--echo
DROP DATABASE mysql_test;

--echo
use test;

--echo
--echo # -- End of Bug#26704.

###########################################################################
