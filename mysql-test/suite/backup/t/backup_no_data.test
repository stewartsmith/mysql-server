--source include/not_embedded.inc

let $MYSQLD_DATADIR= `select @@datadir`;

--disable_warnings
--rmdir $MYSQLD_DATADIR/test
--mkdir $MYSQLD_DATADIR/test
DROP DATABASE IF EXISTS empty_db;
DROP DATABASE IF EXISTS other_db;
--enable_warnings

let $MYSQLD_DATADIR= `select @@datadir`;

CREATE DATABASE empty_db;
CREATE DATABASE other_db;

--error 0,1
--remove_file $MYSQLD_DATADIR/empty_db.bak
--replace_column 1 #
BACKUP DATABASE empty_db TO 'empty_db.bak';

--error 0,1
--remove_file $MYSQLD_DATADIR/all.bak
--replace_column 1 #
BACKUP DATABASE * TO 'all.bak';

DROP DATABASE empty_db;
DROP DATABASE other_db;

SHOW DATABASES;

--replace_column 1 #
RESTORE FROM 'all.bak' OVERWRITE;

SHOW DATABASES;

DROP DATABASE empty_db;
DROP DATABASE other_db;

--replace_column 1 #
RESTORE FROM 'empty_db.bak';

SHOW DATABASES;
SHOW TABLES IN empty_db;

--replace_column 1 #
RESTORE FROM 'all.bak' OVERWRITE;

SHOW DATABASES;
SHOW TABLES IN empty_db;

USE empty_db;

--disable_warnings
DROP TABLE IF EXISTS t1;
--enable_warnings

CREATE TABLE t1 (
  `dir_code` char(4),
  `building` char(6)
) DEFAULT CHARSET=latin1;

--error 0,1
--remove_file $MYSQLD_DATADIR/empty_db.bak
--replace_column 1 #
BACKUP DATABASE empty_db TO 'empty_db.bak';

SHOW DATABASES;

--replace_column 1 #
RESTORE FROM 'empty_db.bak' OVERWRITE;

USE empty_db;

SHOW TABLES;

--disable_warnings
DROP DATABASE IF EXISTS empty_db;
DROP DATABASE IF EXISTS other_db;
#
# Normally, when tests are run the test/ directory corresponding to the test database
# is empty. In particular, it doesn't contain the db.opt file storing database settings.
# Some tests rely on that, as they use server options to determine these settings.
# If we backup test database (e.g., with "BACKUP DATABASE * ...") and then restore it,
# then it will be created using "CREATE DATABASE test" statement and this will create
# the db.opt file. As a result, some tests run after that will fail. To avoid this situation
# we remove the test/db.opt file as a part of clean-up.
#
--error 0,1
--remove_file $MYSQLD_DATADIR/test/db.opt
--enable_warnings

--error 0,1
--remove_file $MYSQLD_DATADIR/all.bak
--error 0,1
--remove_file $MYSQLD_DATADIR/empty_db.bak


